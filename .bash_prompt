function __prompt_command {
    PS1="("
    if [[ $(tput cols) -gt 149 ]]; then
        active_context=$(kubectl config current-context 2>/dev/null)
        if [[ "$active_context" != "" ]]; then
            PS1+="\[$WHITE\] kube: ${active_context} "
        fi

        if [[ "$AWS_PROFILE" != "" ]]; then
            PS1+="\[$WHITE\]| aws: ${AWS_PROFILE} "
        fi

#         if [[ -f "Pulumi.yaml" ]]; then
#             PS1+="\[$WHITE\]| stack: $(get_stack) "
#         fi

        ref="$(git symbolic-ref HEAD 2> /dev/null)"
        if [[ "$ref" != "" ]]; then
            PS1+="\[$WHITE\]| branch: \[$GIT_BRANCH_COLOR\]${ref#refs/heads/} "
        fi
    fi
    
    if [[ "$VIRTUAL_ENV_PROMPT" != "" ]]; then
        PS1+="\[$WHITE\]| venv: $(echo $VIRTUAL_ENV_PROMPT | tr -d '()') "
    fi
    PS1+=")"

    PS1+='\[\033[01;32m\][\u@\h\[\033[01;37m\] \W\[\033[01;32m\]]\$\[\033[00m\] '
}

PROMPT_COMMAND=__prompt_command